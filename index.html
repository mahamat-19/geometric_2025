<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cubic B-Spline Interpolation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        canvas {
            border: 1px solid #000;
            display: block;
            margin-top: 20px;
        }
        .controls {
            margin-bottom: 20px;
        }

        button {
            padding: 8px 12px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h2>Cubic B-Spline Interpolation</h2>
    <div class="controls">
        <button id="addPoint">Add </button>
        <button id="clearPoints">Clear</button>
        <label>
            <input type="checkbox" id="showControl" checked> Show Control Points
        </label>
    </div>
    <canvas id="canvas" width="800" height="400"></canvas>

    <script>
        class BSplineApp {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.points = [];
                this.bindEvents();
                this.draw();
            }
            bindEvents() {
                this.canvas.addEventListener('click', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    this.points.push({ x, y });
                    this.draw();
                });
                document.getElementById('addPoint').addEventListener('click', () => {
                    const x = Math.random() * this.canvas.width;
                    const y = Math.random() * this.canvas.height;
                    this.points.push({ x, y });
                    this.draw();
                });
                document.getElementById('clearPoints').addEventListener('click', () => {
                    this.points = [];
                    this.draw();
                });

                document.getElementById('showControl').addEventListener('change', () => {
                    this.draw();
                });
            }

            draw() {
                const ctx = this.ctx;
                ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                if (document.getElementById('showControl').checked) {
                    this.drawPoints(this.points, 'red', 5);
                }

                const curve = this.computeBSpline(this.points, 20);
                if (curve.length > 0) {
                    ctx.beginPath();
                    ctx.strokeStyle = 'green';
                    ctx.lineWidth = 2;
                    curve.forEach((p, i) => {
                        if (i === 0) {
                            ctx.moveTo(p.x, p.y);
                        } else {
                            ctx.lineTo(p.x, p.y);
                        }
                    });
                    ctx.stroke();
                }
            }

            drawPoints(points, color, radius) {
                const ctx = this.ctx;
                ctx.fillStyle = color;
                points.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, radius, 0, Math.PI * 2);
                    ctx.fill();
                });
            }

            computeBSpline(points, segmentsPerSpan = 20) {
                if (points.length < 4) return [];

                const result = [];

                for (let i = 1; i < points.length - 2; i++) {
                    const p0 = points[i - 1];
                    const p1 = points[i];
                    const p2 = points[i + 1];
                    const p3 = points[i + 2];

                    for (let t = 0; t <= 1; t += 1 / segmentsPerSpan) {
                        const x = this.bSplineFormula(p0.x, p1.x, p2.x, p3.x, t);
                        const y = this.bSplineFormula(p0.y, p1.y, p2.y, p3.y, t);
                        result.push({ x, y });
                    }
                }

                return result;
            }

            bSplineFormula(p0, p1, p2, p3, t) {
                const t2 = t * t;
                const t3 = t2 * t;

                return (
                    (1 / 6) *
                    ((-p0 + 3 * p1 - 3 * p2 + p3) * t3 +
                        (3 * p0 - 6 * p1 + 3 * p2) * t2 +
                        (-3 * p0 + 3 * p2) * t +
                        (p0 + 4 * p1 + p2))
                );
            }
        }
        window.onload = () => {
            new BSplineApp();
        };
    </script>
</body>
</html>
